<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="–ú–µ–≥–∞–ß–∞—Ç">
    <link rel="apple-touch-icon" href="https://via.placeholder.com/180?text=Icon">
    <link rel="manifest" href="/manifest.json">
    <title>–ú–µ–≥–∞–ß–∞—Ç PWA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/10.6.4/math.min.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #6e8efb, #a777e3);
            --secondary-gradient: linear-gradient(135deg, #2b5876, #4e4376);
            --user-message-gradient: linear-gradient(135deg, #4776E6, #8E54E9);
            --bot-message-gradient: linear-gradient(135deg, #654ea3, #eaafc8);
            --sidebar-bg: rgba(255, 255, 255, 0.15);
            --input-bg: rgba(255, 255, 255, 0.12);
            --text-color: #ffffff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--secondary-gradient);
            color: var(--text-color);
            height: 100vh;
            overflow: hidden;
            display: flex;
            position: relative;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 999;
            display: none;
            backdrop-filter: blur(3px);
        }

        #overlay.active {
            display: block;
        }

        #sidebar {
            width: 280px;
            height: 100vh;
            background: var(--sidebar-bg);
            backdrop-filter: blur(12px);
            position: fixed;
            left: -280px;
            top: 0;
            transition: left 0.3s ease;
            padding: 20px;
            box-shadow: var(--shadow);
            z-index: 1000;
            display: flex;
            flex-direction: column;
        }

        #sidebar.open {
            left: 0;
        }

        #sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #new-chat {
            background: var(--primary-gradient);
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
            box-shadow: var(--shadow);
        }

        #new-chat:hover {
            transform: translateY(-2px);
        }

        #chat-list {
            overflow-y: auto;
            flex: 1;
            margin-top: 10px;
        }

        .chat-item {
            padding: 12px 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chat-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateX(5px);
        }

        .chat-item-icon {
            font-size: 18px;
        }

        .chat-item.active {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        #menu-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.15);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            z-index: 1001;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #menu-toggle:hover {
            transform: scale(1.1);
            background: rgba(255, 255, 255, 0.25);
        }

        #chat-container {
            width: 100%;
            max-width: 800px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(12px);
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            animation: fadeIn 0.5s ease-in-out;
            position: relative;
        }

        @media (min-width: 768px) {
            #chat-container {
                border-radius: 20px;
                height: 90vh;
                max-height: 900px;
                margin-top: 5vh;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #chat-header {
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        #chat-title {
            font-weight: 600;
            font-size: 18px;
        }

        #chat-actions {
            display: flex;
            gap: 10px;
        }

        .chat-action-btn {
            background: transparent;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .chat-action-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        #chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 85%;
            padding: 15px 20px;
            border-radius: 18px;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s ease-out;
            line-height: 1.5;
            position: relative;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .user-message {
            align-self: flex-end;
            background: var(--user-message-gradient);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .bot-message {
            align-self: flex-start;
            background: var(--bot-message-gradient);
            color: white;
            border-bottom-left-radius: 5px;
        }

        .message-time {
            font-size: 11px;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }

        #chat-input-container {
            padding: 15px;
            background: rgba(0, 0, 0, 0.15);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        #input-field {
            flex: 1;
            padding: 15px 20px;
            border: none;
            border-radius: 25px;
            background: var(--input-bg);
            color: white;
            font-size: 16px;
            outline: none;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        #input-field:focus {
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        #input-field::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        #input-container {
            display: flex;
            gap: 10px;
            position: relative;
        }

        #send-button {
            background: var(--primary-gradient);
            color: white;
            border: none;
            padding: 0;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow);
        }

        #send-button:hover {
            transform: scale(1.05);
        }

        #send-button svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        #suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 15px;
            max-height: 100px;
            overflow-y: auto;
            padding: 5px;
        }

        .suggestion {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            backdrop-filter: blur(10px);
        }

        .suggestion:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px);
        }

        .typing-indicator {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            background: var(--bot-message-gradient);
            border-radius: 18px;
            align-self: flex-start;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }

        .dot {
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
            margin: 0 3px;
            animation: bounce 1.2s infinite;
        }

        .dot:nth-child(2) { animation-delay: 0.2s; }
        .dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
        @media (max-width: 768px) {
            #sidebar {
                width: 85%;
                left: -85%;
            }
            
            .message {
                max-width: 90%;
            }
            
            #chat-container {
                height: 100vh;
                border-radius: 0;
            }
            
            #menu-toggle {
                top: 15px;
                left: 15px;
            }
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–±–∞—Ä–∞ */
        ::-webkit-scrollbar {
            width: 6px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body>
    <div id="overlay"></div>
    <button id="menu-toggle">‚ò∞</button>
    
    <div id="sidebar">
        <div id="sidebar-header">
            <h3>–ß–∞—Ç—ã</h3>
            <button id="new-chat">+ –ù–æ–≤—ã–π</button>
        </div>
        <div id="chat-list"></div>
    </div>
    
    <div id="chat-container">
        <div id="chat-header">
            <div id="chat-title">–ú–µ–≥–∞–ß–∞—Ç</div>
            <div id="chat-actions">
                <button class="chat-action-btn" title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç">üóëÔ∏è</button>
                <button class="chat-action-btn" title="–ù–∞—Å—Ç—Ä–æ–π–∫–∏">‚öôÔ∏è</button>
            </div>
        </div>
        
        <div id="chat-messages"></div>
        
        <div id="chat-input-container">
            <div id="input-container">
                <input type="text" id="input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button id="send-button">
                    <svg viewBox="0 0 24 24">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                    </svg>
                </button>
            </div>
            <div id="suggestions"></div>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const inputField = document.getElementById('input-field');
        const sendButton = document.getElementById('send-button');
        const suggestionsDiv = document.getElementById('suggestions');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('overlay');
        const menuToggle = document.getElementById('menu-toggle');
        const newChatButton = document.getElementById('new-chat');
        const chatList = document.getElementById('chat-list');
        const clearChatBtn = document.querySelector('.chat-action-btn[title="–û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç"]');

        // Service Worker –¥–ª—è PWA
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(() => console.log('Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
                .catch(err => console.error('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ Service Worker:', err));
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–∞—Ç–∞–º–∏
        let currentChatId = null;
        let chats = JSON.parse(localStorage.getItem('chats')) || {};

        function saveChat() {
            if (currentChatId) {
                chats[currentChatId] = chatMessages.innerHTML;
                localStorage.setItem('chats', JSON.stringify(chats));
            }
        }

        function loadChat(id) {
            currentChatId = id;
            chatMessages.innerHTML = chats[id] || '';
            chatMessages.scrollTop = chatMessages.scrollHeight;
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç –≤ —Å–ø–∏—Å–∫–µ
            document.querySelectorAll('.chat-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.chat-item[data-id="${id}"]`)?.classList.add('active');
        }

        function updateChatList() {
            chatList.innerHTML = '';
            Object.keys(chats).forEach(id => {
                const chatItem = document.createElement('div');
                chatItem.classList.add('chat-item');
                chatItem.setAttribute('data-id', id);
                chatItem.innerHTML = `
                    <span class="chat-item-icon">üí¨</span>
                    <span>–ß–∞—Ç ${id.slice(-4)}</span>
                `;
                chatItem.addEventListener('click', () => loadChat(id));
                chatList.appendChild(chatItem);
            });
            
            // –ü–æ–º–µ—á–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç
            if (currentChatId) {
                document.querySelector(`.chat-item[data-id="${currentChatId}"]`)?.classList.add('active');
            }
        }

        newChatButton.addEventListener('click', () => {
            const newId = Date.now().toString();
            chats[newId] = '';
            localStorage.setItem('chats', JSON.stringify(chats));
            loadChat(newId);
            updateChatList();
        });

        clearChatBtn.addEventListener('click', () => {
            if (confirm('–û—á–∏—Å—Ç–∏—Ç—å —Ç–µ–∫—É—â–∏–π —á–∞—Ç?')) {
                if (currentChatId) {
                    chats[currentChatId] = '';
                    localStorage.setItem('chats', JSON.stringify(chats));
                    loadChat(currentChatId);
                }
            }
        });

        menuToggle.addEventListener('click', () => {
            sidebar.classList.toggle('open');
            overlay.classList.toggle('active');
        });

        overlay.addEventListener('click', () => {
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
        });

        // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —á–∞—Ç–∞
        if (Object.keys(chats).length === 0) {
            const newId = Date.now().toString();
            chats[newId] = '';
            localStorage.setItem('chats', JSON.stringify(chats));
            loadChat(newId);
        } else {
            const lastChatId = Object.keys(chats)[Object.keys(chats).length - 1];
            loadChat(lastChatId);
        }
        updateChatList();

        // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –±–∞–∑–∞ –æ—Ç–≤–µ—Ç–æ–≤
        const botResponses = {
            default: [
                "–•–º, –∏–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è –º—ã—Å–ª—å! –î–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º—Å—è.",
                "–û–≥–æ, —ç—Ç–æ —á—Ç–æ-—Ç–æ –Ω–æ–≤–µ–Ω—å–∫–æ–µ! –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ.",
                "–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª, –Ω–æ –∑–≤—É—á–∏—Ç –∫—Ä—É—Ç–æ. –ß—Ç–æ —Ç—ã –∏–º–µ–µ—à—å –≤ –≤–∏–¥—É?",
                "–ö–ª–∞—Å—Å–Ω–∞—è —Ç–µ–º–∞! –ß—Ç–æ –µ—â–µ –º–æ–∂–µ—à—å —Å–∫–∞–∑–∞—Ç—å?",
                "–ó–≤—É—á–∏—Ç –∏–Ω—Ç—Ä–∏–≥—É—é—â–µ, –ø—Ä–æ–¥–æ–ª–∂–∞–π!",
                "–î–∞–≤–∞–π –∫–æ–ø–Ω–µ–º –≥–ª—É–±–∂–µ, —á—Ç–æ —Ç—ã –¥—É–º–∞–µ—à—å?"
            ],
            hello: ["–ü—Ä–∏–≤–µ—Ç! –†–∞–¥ —Ç–µ–±—è –≤–∏–¥–µ—Ç—å, —á—Ç–æ –Ω–æ–≤–æ–≥–æ?", "–ó–¥–æ—Ä–æ–≤–æ, —á—Ç–æ —Ç—ã —Ç—É—Ç! –ö–∞–∫ –¥–µ–ª–∞?", "–ô–æ, –ø—Ä–∏–≤–µ—Ç! –ß–µ–º –∑–∞–π–º–µ–º—Å—è?", "–ü—Ä–∏–≤–µ—Ç-–ø—Ä–∏–≤–µ—Ç! –ß—Ç–æ –Ω–∞ —É–º–µ?", "–†–∞–¥ –≤—Å—Ç—Ä–µ—á–µ, –¥–∞–≤–∞–π –ø–æ–±–æ–ª—Ç–∞–µ–º!"],
            bye: ["–ü–æ–∫–∞, –±—ã–ª–æ –∫–ª–∞—Å—Å–Ω–æ –±–æ–ª—Ç–∞—Ç—å!", "–î–æ —Å–∫–æ—Ä–æ–≥–æ, –≤–æ–∑–≤—Ä–∞—â–∞–π—Å—è!", "–£–≤–∏–¥–∏–º—Å—è, –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–π!", "–•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è, –¥–æ –≤—Å—Ç—Ä–µ—á–∏!", "–ü–æ–∫–∞-–ø–æ–∫–∞, –¥–µ—Ä–∂–∏ —Ö–≤–æ—Å—Ç –ø–∏—Å—Ç–æ–ª–µ—Ç–æ–º!"],
            weather: ["–ü–æ–≥–æ–¥–∞? –ó–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–≤–æ–µ–≥–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è!", "–°–æ–ª–Ω—Ü–µ –∏–ª–∏ –¥–æ–∂–¥–∏–∫ —É —Ç–µ–±—è —Ç–∞–º?", "–í –º–æ–µ–º –º–∏—Ä–µ –≤—Å–µ–≥–¥–∞ —Å–æ–ª–Ω–µ—á–Ω–æ!", "–ü–æ–≥–æ–¥–∞ ‚Äî –∫–∞–∫ –∂–∏–∑–Ω—å, —Ç–æ —è—Å–Ω–æ, —Ç–æ –æ–±–ª–∞—á–Ω–æ."],
            joke: [
                "–ü–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—ã –ø—å—é—Ç —á–∞–π? –ü–æ—Ç–æ–º—É —á—Ç–æ –∫–æ—Ñ–µ ‚Äî —ç—Ç–æ –±–∞–≥!",
                "–°–ª—ã—à–∞–ª, –∫–∞–∫ —Å–∫–µ–ª–µ—Ç –ø–æ—à—É—Ç–∏–ª? –£ –Ω–µ–≥–æ –∫–æ—Å—Ç–∏ —Å–º–µ—à–Ω—ã–µ!",
                "–ü–æ—á–µ–º—É Wi-Fi —Ä–æ—É—Ç–µ—Ä –≥—Ä—É—Å—Ç–∏–ª? –ù–∏–∫—Ç–æ –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–ª—Å—è!",
                "–ö–∞–∫ –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è –º–µ–¥–≤–µ–¥—å –±–µ–∑ —É—à–µ–π? –ü—Ä–æ—Å—Ç–æ –ë!"
            ],
            name: ["–Ø –ú–µ–≥–∞–ß–∞—Ç, —Ç–≤–æ–π —É–º–Ω—ã–π –¥—Ä—É–≥! –ê —Ç—ã –∫—Ç–æ?", "–ó–æ–≤–∏ –º–µ–Ω—è –ø—Ä–æ—Å—Ç–æ AI, –∞ —Ç–µ–±—è –∫–∞–∫?", "–Ø —Ç–≤–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, –ø—Ä–∏—è—Ç–Ω–æ –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è!"],
            help: ["–Ø —Ç—É—Ç, —á—Ç–æ–±—ã –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã, —à—É—Ç–∏—Ç—å –∏ –¥–∞–∂–µ —Å—á–∏—Ç–∞—Ç—å! –ß—Ç–æ —Ö–æ—á–µ—à—å?", "–°–ø—Ä–æ—Å–∏ —á—Ç–æ —É–≥–æ–¥–Ω–æ, —è –≥–æ—Ç–æ–≤!", "–ù—É–∂–Ω–∞ –ø–æ–º–æ—â—å? –Ø –º–∞—Å—Ç–µ—Ä –Ω–∞ –≤—Å–µ —Ä—É–∫–∏!"],
            love: ["–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–∞–∫ –∫–æ–¥, –≥–ª–∞–≤–Ω–æ–µ –Ω–∞–π—Ç–∏ –±–∞–≥!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞ –≤ –≤–æ–∑–¥—É—Ö–µ, —Ä–∞—Å—Å–∫–∞–∂–∏ —Å–≤–æ—é –∏—Å—Ç–æ—Ä–∏—é!", "–õ—é–±–æ–≤—å ‚Äî —ç—Ç–æ –∫–æ–≥–¥–∞ –¥–≤–∞ —Å–µ—Ä–¥—Ü–∞ –≤ –¥–µ–±–∞–≥–µ."],
            food: ["–ü–∏—Ü—Ü–∞ –∏–ª–∏ –±–æ—Ä—â? –ß—Ç–æ –ª—é–±–∏—à—å?", "–ï–¥–∞ ‚Äî —ç—Ç–æ –ª—é–±–æ–≤—å! –ß—Ç–æ —Å–µ–≥–æ–¥–Ω—è –Ω–∞ —Å—Ç–æ–ª–µ?", "–°—É—à–∏ –∏–ª–∏ —Å—Ç–µ–π–∫? –î–µ–ª–∏—Å—å –≤–∫—É—Å–æ–º!"],
            music: ["–ß—Ç–æ –≤ —Ç–≤–æ–µ–º –ø–ª–µ–π–ª–∏—Å—Ç–µ? –î—Ä–æ–ø–Ω–∏ —Ç—Ä–µ–∫!", "–†–æ–∫, –ø–æ–ø –∏–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—Ç—è–∂–µ–ª–µ–µ?", "–ú—É–∑—ã–∫–∞ ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å, —Å–æ–≥–ª–∞—Å–µ–Ω?"],
            sport: ["–§—É—Ç–±–æ–ª –∏–ª–∏ –π–æ–≥–∞? –ß—Ç–æ –∑–∞—Ä—è–∂–∞–µ—Ç?", "–°–ø–æ—Ä—Ç ‚Äî —ç—Ç–æ –∫–∞–π—Ñ! –ß—Ç–æ –¥–µ–ª–∞–µ—à—å?", "–ö—Ç–æ —Ç–≤–æ–π —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –≥–µ—Ä–æ–π?"],
            travel: ["–ö—É–¥–∞ –±—ã —Ä–≤–∞–Ω—É–ª –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å?", "–ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è ‚Äî —ç—Ç–æ —Å–≤–æ–±–æ–¥–∞! –ë—ã–ª –≥–¥–µ-—Ç–æ –∫—Ä—É—Ç–æ?", "–ú–µ—á—Ç–∞–µ—à—å –æ –ü–∞—Ä–∏–∂–µ –∏–ª–∏ –¢–æ–∫–∏–æ?"],
            work: ["–†–∞–±–æ—Ç–∞ –∫–∏–ø–∏—Ç? –†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ —Å–≤–æ–π –¥–µ–Ω—å!", "–ö–∞—Ä—å–µ—Ä–∞ ‚Äî —ç—Ç–æ –º–∞—Ä–∞—Ñ–æ–Ω, –∫–∞–∫ –±–µ–∂–∏—à—å?", "–ö–∞–∫–æ–π —Ç–≤–æ–π —Ä–∞–±–æ—á–∏–π –ª–∞–π—Ñ—Ö–∞–∫?"],
            hobby: ["–ß–µ–º —É–≤–ª–µ–∫–∞–µ—à—å—Å—è –≤ —Å–≤–æ–±–æ–¥–Ω–æ–µ –≤—Ä–µ–º—è?", "–•–æ–±–±–∏ ‚Äî —ç—Ç–æ –æ—Ç–¥—É—à–∏–Ω–∞! –ß—Ç–æ —Ç–≤–æ–µ?", "–ü—Ä–æ–±–æ–≤–∞–ª —á—Ç–æ-—Ç–æ –Ω–µ–æ–±—ã—á–Ω–æ–µ?"],
            ai: ["–Ø –ò–ò, –Ω–æ —Å –¥—É—à–æ–π, —á–µ—Å—Ç–Ω–æ!", "–ò–ò ‚Äî —ç—Ç–æ –±—É–¥—É—â–µ–µ, –∫–∞–∫ –¥—É–º–∞–µ—à—å?", "–ß—Ç–æ —Å–∫–∞–∂–µ—à—å –ø—Ä–æ —É–º–Ω—ã—Ö –±–æ—Ç–æ–≤ –≤—Ä–æ–¥–µ –º–µ–Ω—è?"],
            politics: ["–ü–æ–ª–∏—Ç–∏–∫–∞ ‚Äî –≥–æ—Ä—è—á–∞—è —Ç–µ–º–∞, —á—Ç–æ –¥—É–º–∞–µ—à—å?", "–°–ª–µ–¥–∏—à—å –∑–∞ –Ω–æ–≤–æ—Å—Ç—è–º–∏? –ß—Ç–æ –≤–æ–ª–Ω—É–µ—Ç?", "–î–∞–≤–∞–π –±–µ–∑ —Å–ø–æ—Ä–æ–≤, –Ω–æ —è —Å–ª—É—à–∞—é!"],
            science: ["–ù–∞—É–∫–∞ ‚Äî —ç—Ç–æ –∫–æ—Å–º–æ—Å! –ß—Ç–æ —Ç–µ–±—è —Ü–µ–ø–ª—è–µ—Ç?", "–ö–≤–∞–Ω—Ç–æ–≤–∞—è —Ñ–∏–∑–∏–∫–∞ –∏–ª–∏ –±–∏–æ–ª–æ–≥–∏—è?", "–ó–Ω–∞–ª, —á—Ç–æ —Å–≤–µ—Ç ‚Äî —ç—Ç–æ –≤–æ–ª–Ω–∞ –∏ —á–∞—Å—Ç–∏—Ü–∞?"],
            history: ["–ò—Å—Ç–æ—Ä–∏—è ‚Äî –∫–∞–∫ –º–∞—à–∏–Ω–∞ –≤—Ä–µ–º–µ–Ω–∏! –õ—é–±–∏–º–∞—è —ç–ø–æ—Ö–∞?", "–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –†–∏–º –∏–ª–∏ –≤–∏–∫–∏–Ω–≥–æ–≤!", "–ò—Å—Ç–æ—Ä–∏—è —É—á–∏—Ç, –Ω–æ –Ω–µ –≤—Å–µ —Å–ª—É—à–∞—é—Ç."],
            movies: ["–ö–∞–∫–æ–π —Ñ–∏–ª—å–º –∑–∞—Ü–µ–ø–∏–ª? –ú–æ–π ‚Äî '–ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä'!", "–ö–∏–Ω–æ ‚Äî —ç—Ç–æ –º–∞–≥–∏—è! –ß—Ç–æ —Å–º–æ—Ç—Ä–µ–ª –Ω–µ–¥–∞–≤–Ω–æ?", "–ö–æ–º–µ–¥–∏—è –∏–ª–∏ —Ç—Ä–∏–ª–ª–µ—Ä?"],
            books: ["–ß–∏—Ç–∞–µ—à—å? '–î—é–Ω–∞' ‚Äî –æ–≥–æ–Ω—å!", "–ö–∞–∫–æ–π –∂–∞–Ω—Ä —Ç–≤–æ–π? –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞ –∏–ª–∏ –∫–ª–∞—Å—Å–∏–∫–∞?", "–ö–Ω–∏–≥–∏ ‚Äî —ç—Ç–æ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è –±–µ–∑ –ø–∞—Å–ø–æ—Ä—Ç–∞!"],
            health: ["–ó–¥–æ—Ä–æ–≤—å–µ ‚Äî –Ω–∞—à–µ –≤—Å—ë! –ö–∞–∫ –¥–µ—Ä–∂–∏—à—å —Ñ–æ—Ä–º—É?", "–°–æ–Ω –∏ –≤–æ–¥–∞ ‚Äî –ª—É—á—à–∏–µ –¥—Ä—É–∑—å—è, —Å–æ–≥–ª–∞—Å–µ–Ω?", "–ô–æ–≥–∞ –∏–ª–∏ —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∫–∞?"],
            tech: ["–ì–∞–¥–∂–µ—Ç—ã ‚Äî —ç—Ç–æ –∂–∏–∑–Ω—å! –ß—Ç–æ —É —Ç–µ–±—è –≤ –∫–∞—Ä–º–∞–Ω–µ?", "VR –∏–ª–∏ AR ‚Äî —á—Ç–æ –∫—Ä—É—á–µ?", "–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏ –ª–µ—Ç—è—Ç, —É—Å–ø–µ–≤–∞–µ—à—å?"],
            environment: ["–ü–ª–∞–Ω–µ—Ç–∞ –ø—Ä–æ—Å–∏—Ç –∑–∞–±–æ—Ç—ã, —á—Ç–æ –¥—É–º–∞–µ—à—å?", "–≠–∫–æ–ª–æ–≥–∏—è ‚Äî –Ω–∞—à –¥–æ–ª–≥!", "–ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ —Å–ø–∞—Å–∞–µ—Ç –º–∏—Ä!"],
            education: ["–£—á–∏—Ç—å—Å—è –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–æ–∑–¥–Ω–æ! –ß—Ç–æ –∏–∑—É—á–∞–µ—à—å?", "–û–Ω–ª–∞–π–Ω-–∫—É—Ä—Å—ã –∏–ª–∏ –∫–Ω–∏–≥–∏?", "–ó–Ω–∞–Ω–∏—è ‚Äî —ç—Ç–æ —Å–∏–ª–∞!"],
            math: ["–ö–∏–¥–∞–π –∑–∞–¥–∞—á—É, —è —Ä–µ—à—É!", "–ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞ ‚Äî —ç—Ç–æ –∫–∞–∫ –ø–∞–∑–ª!", "–ß–∏—Å–ª–∞ –Ω–µ –≤—Ä—É—Ç, –¥–∞–≤–∞–π –ø—Ä–æ–≤–µ—Ä–∏–º!"],
            news: ["–ß—Ç–æ –≤ –º–∏—Ä–µ —Ç–≤–æ—Ä–∏—Ç—Å—è? –†–∞—Å—Å–∫–∞–∂–∏!", "–ù–æ–≤–æ—Å—Ç–∏ —Å–ª–µ–¥–∏—à—å? –ß—Ç–æ –≥–æ—Ä—è—á–µ–≥–æ?", "–ú–∏—Ä –º–µ–Ω—è–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ!"],
            games: ["–ò–≥—Ä–∞–µ—à—å? –í–æ —á—Ç–æ –∑–∞–ª–∏–ø–∞–µ—à—å?", "–ö–æ–Ω—Å–æ–ª–∏ –∏–ª–∏ –ü–ö? –í—ã–±–∏—Ä–∞–π!", "–õ—é–±–∏–º–∞—è –∏–≥—Ä–∞ ‚Äî –∫–∞–∫–∞—è?"],
            art: ["–ò—Å–∫—É—Å—Å—Ç–≤–æ ‚Äî —ç—Ç–æ –¥—É—à–∞! –õ—é–±–∏—à—å —Ä–∏—Å–æ–≤–∞—Ç—å?", "–ö—Ç–æ —Ç–≤–æ–π –ª—é–±–∏–º—ã–π —Ö—É–¥–æ–∂–Ω–∏–∫?", "–ú—É–∑–µ–∏ –∏–ª–∏ —É–ª–∏—á–Ω–æ–µ –∏—Å–∫—É—Å—Å—Ç–≤–æ?"],
            space: ["–ö–æ—Å–º–æ—Å –º–∞–Ω–∏—Ç! –ß—Ç–æ –¥—É–º–∞–µ—à—å –æ –ú–∞—Ä—Å–µ?", "–ó–≤–µ–∑–¥—ã ‚Äî —ç—Ç–æ –º–µ—á—Ç—ã!", "–°–ª—ã—à–∞–ª –ø—Ä–æ —á–µ—Ä–Ω—ã–µ –¥—ã—Ä—ã?"],
            philosophy: ["–§–∏–ª–æ—Å–æ—Ñ–∏—è ‚Äî —ç—Ç–æ –ø—Ä–æ —Å–º—ã—Å–ª –∂–∏–∑–Ω–∏. –ß—Ç–æ –¥—É–º–∞–µ—à—å?", "–ë—ã—Ç—å –∏–ª–∏ –Ω–µ –±—ã—Ç—å, –≤–æ—Ç –≤ —á–µ–º –≤–æ–ø—Ä–æ—Å!", "–ö—Ç–æ –º—ã –≤ —ç—Ç–æ–º –º–∏—Ä–µ?"],
            culture: ["–ö—É–ª—å—Ç—É—Ä–∞ ‚Äî —ç—Ç–æ –º–æ—Å—Ç—ã –º–µ–∂–¥—É –ª—é–¥—å–º–∏!", "–ö–∞–∫–∏–µ —Ç—Ä–∞–¥–∏—Ü–∏–∏ —Ç–µ–±–µ –Ω—Ä–∞–≤—è—Ç—Å—è?", "–ü—Ä–∞–∑–¥–Ω–∏–∫–∏ ‚Äî —ç—Ç–æ –∫–∞–π—Ñ!"],
            weather_specific: ["–ü–æ–≥–æ–¥–∞ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –º–µ—Å—Ç–∞! –ù–∞–∑–æ–≤–∏ –≥–æ—Ä–æ–¥, —É—Ç–æ—á–Ω—é.", "–°–æ–ª–Ω–µ—á–Ω–æ –∏–ª–∏ –ø–∞—Å–º—É—Ä–Ω–æ? –ì–¥–µ —Ç—ã —Å–µ–π—á–∞—Å?", "–ü–æ–≥–æ–¥–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ, –ø—Ä–∞–≤–¥–∞?"],
            time: ["–í—Ä–µ–º—è –ª–µ—Ç–∏—Ç! –•–æ—á–µ—à—å –∑–Ω–∞—Ç—å —Ç–æ—á–Ω–æ–µ –≤—Ä–µ–º—è?", "–°–µ–π—á–∞—Å —É—Ç—Ä–æ, –¥–µ–Ω—å –∏–ª–∏ –Ω–æ—á—å —É —Ç–µ–±—è?", "–í—Ä–µ–º—è ‚Äî —Å–∞–º—ã–π —Ü–µ–Ω–Ω—ã–π —Ä–µ—Å—É—Ä—Å!"],
            advice: ["–ù—É–∂–µ–Ω —Å–æ–≤–µ—Ç? –†–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –≤–æ–ª–Ω—É–µ—Ç!", "–ú–æ–π —Å–æ–≤–µ—Ç: –¥–µ–ª–∞–π, —á—Ç–æ –ª—é–±–∏—à—å!", "–ò–Ω–æ–≥–¥–∞ –ø—Ä–æ—Å—Ç–æ —Å—Ç–æ–∏—Ç –≤—ã–¥–æ—Ö–Ω—É—Ç—å."],
        };

        // T9 —Å API Datamuse
        async function updateSuggestions(input) {
            suggestionsDiv.innerHTML = '';
            if (!input) return;
            try {
                const response = await fetch(`https://api.datamuse.com/words?sp=${encodeURIComponent(input)}*`);
                const data = await response.json();
                const filtered = data.map(item => item.word).slice(0, 5);
                filtered.forEach(word => {
                    const suggestion = document.createElement('div');
                    suggestion.classList.add('suggestion');
                    suggestion.textContent = word;
                    suggestion.addEventListener('click', () => {
                        inputField.value = word;
                        suggestionsDiv.innerHTML = '';
                        sendButton.click();
                    });
                    suggestionsDiv.appendChild(suggestion);
                });
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ Datamuse API:', error);
                const localSuggestions = botResponses.default.concat(...Object.values(botResponses)).filter(word => word.toLowerCase().startsWith(input.toLowerCase())).slice(0, 5);
                localSuggestions.forEach(word => {
                    const suggestion = document.createElement('div');
                    suggestion.classList.add('suggestion');
                    suggestion.textContent = word;
                    suggestion.addEventListener('click', () => {
                        inputField.value = word;
                        suggestionsDiv.innerHTML = '';
                        sendButton.click();
                    });
                    suggestionsDiv.appendChild(suggestion);
                });
            }
        }

        function addMessage(text, isUser) {
            const message = document.createElement('div');
            message.classList.add('message', isUser ? 'user-message' : 'bot-message');
            message.textContent = text;
            
            // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è —Å–æ–æ–±—â–µ–Ω–∏—è
            const time = document.createElement('div');
            time.classList.add('message-time');
            const now = new Date();
            time.textContent = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            message.appendChild(time);
            
            chatMessages.appendChild(message);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            saveChat();
        }

        function showTyping() {
            const typing = document.createElement('div');
            typing.classList.add('typing-indicator');
            typing.innerHTML = '<div class="dot"></div><div class="dot"></div><div class="dot"></div>';
            chatMessages.appendChild(typing);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return typing;
        }

        // –£–ª—É—á—à–µ–Ω–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è: –¥–∏–∞–ª–æ–≥ –∏–ª–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
        function isInformationalQuery(input) {
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –∑–∞–ø—Ä–æ—Å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º
            if (isMathExpression(input)) {
                return false; // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
            }
            
            const informationalKeywords = ['–∫—Ç–æ', '—á—Ç–æ', '–≥–¥–µ', '–∫–æ–≥–¥–∞', '–ø–æ—á–µ–º—É', '–∫–∞–∫', '—Å–∫–æ–ª—å–∫–æ', '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '–∫–∞–∫–æ–µ', '–∫—Ç–æ —Ç–∞–∫–æ–π', '—á—Ç–æ —Ç–∞–∫–æ–µ', '—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ', '–æ–±—ä—è—Å–Ω–∏', '–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è', '–∑–Ω–∞—Ç—å', '—É–∑–Ω–∞—Ç—å'];
            const hasInfoKeyword = informationalKeywords.some(keyword => input.toLowerCase().includes(keyword));
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å –≤–æ–ø—Ä–æ—Å (–≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞ –∏–ª–∏ –∑–Ω–∞–∫ –≤–æ–ø—Ä–æ—Å–∞)
            const isQuestion = /^(–∫—Ç–æ|—á—Ç–æ|–≥–¥–µ|–∫–æ–≥–¥–∞|–ø–æ—á–µ–º—É|–∫–∞–∫|—Å–∫–æ–ª—å–∫–æ|–∑–∞—á–µ–º|–ª–∏)\s|.*\?$/.test(input.toLowerCase());
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å, —Å—á–∏—Ç–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–º
            return hasInfoKeyword || isQuestion;
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
        function isMathExpression(input) {
            // –£–±–∏—Ä–∞–µ–º –≤—Å–µ –±—É–∫–≤—ã –∏ –ø—Ä–æ–±–µ–ª—ã, –æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –∏ —Ü–∏—Ñ—Ä—ã
            const mathOnly = input.replace(/[^0-9+\-*/.^()%]/g, '');
            
            // –ï—Å–ª–∏ –ø–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ –æ—Å—Ç–∞–ª–∞—Å—å –∑–Ω–∞—á–∏–º–∞—è —á–∞—Å—Ç—å —Ç–µ–∫—Å—Ç–∞ - —ç—Ç–æ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ
            if (mathOnly.length >= 3 && /[0-9]/.test(mathOnly) && /[\+\-\*\/\^]/.test(mathOnly)) {
                return true;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
            const mathPatterns = [
                /–ø–æ—Å—á–∏—Ç–∞–π/,
                /–≤—ã—á–∏—Å–ª–∏/,
                /—Ä–µ—à–∏ –ø—Ä–∏–º–µ—Ä/,
                /—Å–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç/,
                /\/\d/,
                /\d\s*[\+\-\*\/\^]\s*\d/,
                /–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –∫–æ—Ä–µ–Ω—å/,
                /–≤–æ–∑–≤–µ–¥–∏ –≤ —Å—Ç–µ–ø–µ–Ω—å/,
                /sin|cos|tan|log|ln/i
            ];
            
            return mathPatterns.some(pattern => pattern.test(input));
        }

        // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–º—ã —Å–æ–æ–±—â–µ–Ω–∏—è
        function detectTopic(input) {
            const lowerInput = input.toLowerCase();
            let key = 'default';

            // –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
            if (/(–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π|–¥–æ–±—Ä—ã–π|—Ö–∞–π|hello|hi)/.test(lowerInput)) key = 'hello';
            else if (/(–ø–æ–∫–∞|–¥–æ —Å–≤–∏–¥–∞–Ω–∏—è|–ø—Ä–æ—â–∞–π|—É–≤–∏–¥–∏–º—Å—è|goodbye)/.test(lowerInput)) key = 'bye';
            else if (/(–ø–æ–≥–æ–¥–∞|–ø–æ–≥–æ–¥—É|weather)/.test(lowerInput) && /(–≤ |–≥–æ—Ä–æ–¥–µ|–≥–æ—Ä–æ–¥|–º–µ—Å—Ç–µ)/.test(lowerInput)) key = 'weather_specific';
            else if (/(–ø–æ–≥–æ–¥–∞|–ø–æ–≥–æ–¥—É|weather)/.test(lowerInput)) key = 'weather';
            else if (/(—à—É—Ç–∫|–∞–Ω–µ–∫–¥–æ—Ç|–ø–æ—à—É—Ç–∏|joke|funny)/.test(lowerInput)) key = 'joke';
            else if (/(–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç|–∏–º—è|who are you)/.test(lowerInput)) key = 'name';
            else if (/(–ø–æ–º–æ—â—å|help|—á—Ç–æ —Ç—ã —É–º–µ–µ—à—å)/.test(lowerInput)) key = 'help';
            else if (/(–ª—é–±–æ–≤|—Ä–æ–º–∞–Ω|—Å–µ—Ä–¥—Ü–µ|love|heart)/.test(lowerInput)) key = 'love';
            else if (/(–µ–¥–∞|–∫—É—Ö–Ω|—Ä–µ—Ü–µ–ø—Ç|–ø–∏—Ü—Ü|–±—É—Ä–≥–µ—Ä|food|eat)/.test(lowerInput)) key = 'food';
            else if (/(–º—É–∑—ã–∫|–ø–µ—Å–Ω|—Ç—Ä–µ–∫|music|song)/.test(lowerInput)) key = 'music';
            else if (/(—Å–ø–æ—Ä—Ç|—Ñ—É—Ç–±–æ–ª|–π–æ–≥|—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫|sport|fit)/.test(lowerInput)) key = 'sport';
            else if (/(–ø—É—Ç–µ—à–µ—Å—Ç–≤|–æ—Ç–ø—É—Å–∫|–ø–æ–µ–∑–¥–∫|travel|trip)/.test(lowerInput)) key = 'travel';
            else if (/(—Ä–∞–±–æ—Ç|–∫–∞—Ä—å–µ—Ä|–ø—Ä–æ—Ñ–µ—Å—Å–∏|work|job)/.test(lowerInput)) key = 'work';
            else if (/(—Ö–æ–±–±–∏|—É–≤–ª–µ—á–µ–Ω|hobby)/.test(lowerInput)) key = 'hobby';
            else if (/(–∏–∏|–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç|ai|–Ω–µ–π—Ä–æ—Å–µ—Ç—å)/.test(lowerInput)) key = 'ai';
            else if (/(–ø–æ–ª–∏—Ç–∏–∫|–≤—ã–±–æ—Ä|–≤–ª–∞—Å—Ç|politics)/.test(lowerInput)) key = 'politics';
            else if (/(–Ω–∞—É–∫|—Ñ–∏–∑–∏–∫|–±–∏–æ–ª–æ–≥–∏|—Ö–∏–º–∏|science)/.test(lowerInput)) key = 'science';
            else if (/(–∏—Å—Ç–æ—Ä–∏|–ø—Ä–æ—à–ª–æ–µ|–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫|history)/.test(lowerInput)) key = 'history';
            else if (/(—Ñ–∏–ª—å–º|–∫–∏–Ω–æ|—Å–µ—Ä–∏–∞–ª|movie|film)/.test(lowerInput)) key = 'movies';
            else if (/(–∫–Ω–∏–≥|–ª–∏—Ç–µ—Ä–∞—Ç—É—Ä|read|book)/.test(lowerInput)) key = 'books';
            else if (/(–∑–¥–æ—Ä–æ–≤—å|–º–µ–¥–∏—Ü–∏–Ω|–±–æ–ª–µ–∑–Ω|health)/.test(lowerInput)) key = 'health';
            else if (/(—Ç–µ—Ö–Ω–æ–ª–æ–≥|–≥–∞–¥–∂–µ—Ç|—Å–º–∞—Ä—Ç—Ñ–æ–Ω|tech|gadget)/.test(lowerInput)) key = 'tech';
            else if (/(—ç–∫–æ–ª–æ–≥–∏|–ø—Ä–∏—Ä–æ–¥|environment|ecology)/.test(lowerInput)) key = 'environment';
            else if (/(–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏|—É—á—ë–±|—É—á–∏—Ç|education)/.test(lowerInput)) key = 'education';
            else if (/(–º–∞—Ç–µ–º–∞—Ç–∏–∫|–ø–æ—Å—á–∏—Ç–∞–π|–≤—ã—á–∏—Å–ª–∏|—Ä–µ—à–∏|math|calculate)/.test(lowerInput)) key = 'math';
            else if (/(–Ω–æ–≤–æ—Å—Ç|news)/.test(lowerInput)) key = 'news';
            else if (/(–∏–≥—Ä|gaming|game|play)/.test(lowerInput)) key = 'games';
            else if (/(–∏—Å–∫—É—Å—Å—Ç–≤|—Ö—É–¥–æ–∂|art|paint)/.test(lowerInput)) key = 'art';
            else if (/(–∫–æ—Å–º–æ—Å|–ø–ª–∞–Ω–µ—Ç|–∑–≤–µ–∑–¥|space)/.test(lowerInput)) key = 'space';
            else if (/(—Ñ–∏–ª–æ—Å–æ—Ñ–∏|—Å–º—ã—Å–ª –∂–∏–∑–Ω–∏|philosophy)/.test(lowerInput)) key = 'philosophy';
            else if (/(–∫—É–ª—å—Ç—É—Ä|—Ç—Ä–∞–¥–∏—Ü|culture)/.test(lowerInput)) key = 'culture';
            else if (/(–≤—Ä–µ–º|time|—á–∞—Å)/.test(lowerInput)) key = 'time';
            else if (/(—Å–æ–≤–µ—Ç|–ø–æ—Å–æ–≤–µ—Ç—É–π|advice)/.test(lowerInput)) key = 'advice';

            return key;
        }

        async function getBotResponse(userInput) {
            const lowerInput = userInput.toLowerCase();
            const topic = detectTopic(lowerInput);
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–¥–∞—á
            if (isMathExpression(userInput)) {
                try {
                    // –ó–∞–º–µ–Ω—è–µ–º —Ä—É—Å—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –¥–ª—è mathjs
                    const mathExpression = userInput
                        .replace(/—Ö/g, '*')
                        .replace(/:/g, '/')
                        .replace(/[^0-9+\-*/.^()%]/g, '');
                    
                    const result = math.evaluate(mathExpression);
                    return `–†–µ–∑—É–ª—å—Ç–∞—Ç: ${result}`;
                } catch (error) {
                    return "–ù–µ —Å–º–æ–≥ —Ä–µ—à–∏—Ç—å —ç—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ. –ú–æ–∂–µ—à—å –Ω–∞–ø–∏—Å–∞—Ç—å –µ–≥–æ –ø–æ-–¥—Ä—É–≥–æ–º—É?";
                }
            }

            // –ï—Å–ª–∏ —ç—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
            if (isInformationalQuery(userInput)) {
                try {
                    // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–±—É–µ–º DuckDuckGo Instant Answer API
                    const duckResponse = await fetch(`https://api.duckduckgo.com/?q=${encodeURIComponent(userInput)}&format=json&no_html=1`);
                    const duckData = await duckResponse.json();
                    
                    if (duckData.AbstractText) {
                        const text = duckData.AbstractText;
                        return text.length > 300 ? text.substring(0, 300).split('. ').slice(0, -1).join('. ') + '...' : text;
                    } else if (duckData.RelatedTopics && duckData.RelatedTopics.length > 0) {
                        const text = duckData.RelatedTopics[0].Text;
                        return text.length > 300 ? text.substring(0, 300).split('. ').slice(0, -1).join('. ') + '...' : text;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ DuckDuckGo API:', error);
                }

                // Fallback –Ω–∞ Wikipedia API
                try {
                    const wikiResponse = await fetch(`https://ru.wikipedia.org/w/api.php?action=query&format=json&list=search&srsearch=${encodeURIComponent(userInput)}&origin=*`);
                    const wikiData = await wikiResponse.json();
                    
                    if (wikiData.query.search.length > 0) {
                        const text = wikiData.query.search[0].snippet.replace(/<[^>]+>/g, '');
                        return text.length > 300 ? text.substring(0, 300).split('. ').slice(0, -1).join('. ') + '...' : text;
                    }
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ Wikipedia API:', error);
                }
            }

            // –î–∏–∞–ª–æ–≥–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã (–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ)
            return botResponses[topic][Math.floor(Math.random() * botResponses[topic].length)];
        }

        sendButton.addEventListener('click', async () => {
            const userInput = inputField.value.trim();
            if (!userInput) return;
            
            addMessage(userInput, true);
            inputField.value = '';
            suggestionsDiv.innerHTML = '';
            
            const typing = showTyping();
            // –ó–∞–¥–µ—Ä–∂–∫–∞ –æ—Ç–≤–µ—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∑–∞–ø—Ä–æ—Å–∞
            const delay = isMathExpression(userInput) ? 1000 : 1500;
            
            setTimeout(async () => {
                chatMessages.removeChild(typing);
                const response = await getBotResponse(userInput);
                addMessage(response, false);
            }, delay);
        });

        inputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendButton.click();
        });

        inputField.addEventListener('input', () => {
            updateSuggestions(inputField.value);
        });

        // –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        setTimeout(() => {
            addMessage("–ü—Ä–∏–≤–µ—Ç! –Ø –ú–µ–≥–∞–ß–∞—Ç, —Ç–≤–æ–π —É–º–Ω—ã–π —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫. –ú–æ–≥—É –±–æ–ª—Ç–∞—Ç—å, —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏, –∏—Å–∫–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –∏ —à—É—Ç–∏—Ç—å. –ß—Ç–æ —Ö–æ—á–µ—à—å –æ–±—Å—É–¥–∏—Ç—å?", false);
        }, 500);
    </script>
</body>
</html>
